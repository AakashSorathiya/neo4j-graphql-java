:toc:

= Cypher WHERE

Tests for queries using `options::useWhereFilter`

== Inputs

[source,graphql,schema=true]
----
type Actor {
    name: String
    movies: [Movie] @relation(name: "ACTED_IN", direction: OUT)
}

type Movie {
    id: ID
    title: String
    actors: [Actor] @relation(name: "ACTED_IN", direction: IN)
    isFavorite: Boolean
}
----

== Configuration

.Configuration
[source,json,schema-config=true]
----
{
  "queryOptionStyle": "INPUT_TYPE",
  "inputStyle": "INPUT_TYPE",
  "useWhereFilter": true,
  "pluralizeFields": true,
  "useTemporalScalars": true,
  "enableStatistics": true
}
----

== Tests

=== Simple

.GraphQL-Query
[source,graphql]
----
query($title: String, $isFavorite: Boolean) {
    movies(where: { title: $title, isFavorite: $isFavorite }) {
        title
    }
}
----

.GraphQL params input
[source,json,request=true]
----
{ "title": "some title", "isFavorite": true }
----

.Expected Cypher params
[source,json]
----
{
  "whereMoviesIsFavorite" : true,
  "whereMoviesTitle" : "some title"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (movies:Movie)
WHERE (movies.title = $whereMoviesTitle
	AND movies.isFavorite = $whereMoviesIsFavorite)
RETURN movies {
	.title
} AS movies
----

=== Simple AND

.GraphQL-Query
[source,graphql]
----
{
    movies(where: { AND: [{ title: "some title" }] }) {
        title
    }
}
----

.Expected Cypher params
[source,json]
----
{
  "whereMoviesTitle" : "some title"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (movies:Movie)
WHERE movies.title = $whereMoviesTitle
RETURN movies {
	.title
} AS movies
----

=== Nested AND

.GraphQL-Query
[source,graphql]
----
{
    movies(where: { AND: [{ AND: [{ title: "some title" }] }] }) {
        title
    }
}
----

.Expected Cypher params
[source,json]
----
{
  "whereMoviesTitle" : "some title"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (movies:Movie)
WHERE movies.title = $whereMoviesTitle
RETURN movies {
	.title
} AS movies
----

=== Super Nested AND

.GraphQL-Query
[source,graphql]
----
{
    movies(where: { AND: [{ AND: [{ AND: [{ title: "some title" }] }] }] }) {
        title
    }
}
----

.Expected Cypher params
[source,json]
----
{
  "whereMoviesTitle" : "some title"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (movies:Movie)
WHERE movies.title = $whereMoviesTitle
RETURN movies {
	.title
} AS movies
----

=== Simple OR

.GraphQL-Query
[source,graphql]
----
{
    movies(where: { OR: [{ title: "some title" }] }) {
        title
    }
}
----

.Expected Cypher params
[source,json]
----
{
  "whereMoviesTitle" : "some title"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (movies:Movie)
WHERE movies.title = $whereMoviesTitle
RETURN movies {
	.title
} AS movies
----

=== Nested OR

.GraphQL-Query
[source,graphql]
----
{
    movies(where: { OR: [{ OR: [{ title: "some title" }] }] }) {
        title
    }
}
----

.Expected Cypher params
[source,json]
----
{
  "whereMoviesTitle" : "some title"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (movies:Movie)
WHERE movies.title = $whereMoviesTitle
RETURN movies {
	.title
} AS movies
----

=== Super Nested OR

.GraphQL-Query
[source,graphql]
----
{
    movies(where: { OR: [{ OR: [{ OR: [{ title: "some title" }] }] }] }) {
        title
    }
}
----

.Expected Cypher params
[source,json]
----
{
  "whereMoviesTitle" : "some title"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (movies:Movie)
WHERE movies.title = $whereMoviesTitle
RETURN movies {
	.title
} AS movies
----

=== Simple IN

.GraphQL-Query
[source,graphql]
----
{
    movies(where: { title_in: ["some title"] }) {
        title
    }
}
----

.Expected Cypher params
[source,json]
----
{
  "whereMoviesTitleIn" : [ "some title" ]
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (movies:Movie)
WHERE movies.title IN $whereMoviesTitleIn
RETURN movies {
	.title
} AS movies
----
